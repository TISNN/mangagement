# 会议文档独立编辑功能完成说明

## ✅ 功能实现

在会议管理页面顶部的"创建会议"按钮旁边添加了"创建会议文档"按钮,点击后可以进入一个独立的全屏富文本编辑器页面,专门用于创建和编辑会议文档。

## 📝 实现细节

### 1. 创建数据表 `meeting_documents`

**数据库迁移**: `create_meeting_documents_table`

**表结构**:
```sql
CREATE TABLE meeting_documents (
  id BIGSERIAL PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by INTEGER NOT NULL,
  title TEXT NOT NULL,
  content TEXT,
  CONSTRAINT meeting_documents_created_by_fkey 
    FOREIGN KEY (created_by) REFERENCES employees(id) ON DELETE CASCADE
);
```

**字段说明**:
- `id`: 文档ID(主键)
- `created_at`: 创建时间
- `updated_at`: 更新时间(自动触发器)
- `created_by`: 创建人(员工ID,外键关联 employees 表)
- `title`: 文档标题
- `content`: 文档内容(富文本HTML)

**索引**:
- `idx_meeting_documents_created_by`: 创建人索引
- `idx_meeting_documents_created_at`: 创建时间索引(降序)

### 2. 创建会议文档编辑器页面

**文件位置**: `src/pages/admin/MeetingDocumentEditorPage.tsx`

**功能特点**:
- 全屏编辑体验,无干扰
- 顶部固定操作栏,包含返回、标题输入、保存按钮
- 使用 Tiptap 富文本编辑器
- 支持新建和编辑两种模式
- 自动保存到 Supabase 数据库
- 创建成功后自动跳转到编辑模式

**UI 布局**:
```
┌─────────────────────────────────────────────────┐
│ [← 返回] 📄 [文档标题输入框]        [💾 保存] │ <- 固定顶栏
├─────────────────────────────────────────────────┤
│                                                 │
│                                                 │
│          Tiptap 富文本编辑器区域               │
│          (支持所有富文本功能)                   │
│                                                 │
│                                                 │
└─────────────────────────────────────────────────┘
```

**代码实现**:
```tsx
// 状态管理
const [title, setTitle] = useState('');
const [content, setContent] = useState('');
const [saving, setSaving] = useState(false);
const [loading, setLoading] = useState(isEditMode);

// 保存文档
const handleSave = async () => {
  if (isEditMode && id) {
    // 更新现有文档
    await supabase
      .from('meeting_documents')
      .update({ title, content, updated_at: new Date().toISOString() })
      .eq('id', id);
  } else {
    // 创建新文档
    const { data } = await supabase
      .from('meeting_documents')
      .insert({ title, content, created_by: employee.id })
      .select()
      .single();
    
    // 创建成功后跳转到编辑模式
    navigate(`/admin/meeting-documents/${data.id}`, { replace: true });
  }
};
```

### 3. 更新会议管理页面

**文件位置**: `src/pages/admin/MeetingsPage.tsx`

**修改内容**:
- 导入 `FileText` 图标
- 修改标题栏布局,添加按钮组
- 新增"创建会议文档"按钮(白底蓝边样式)
- 保留"创建会议"按钮(蓝底白字样式)

**按钮布局**:
```tsx
<div className="flex items-center gap-3">
  {/* 创建会议文档按钮 - 白底蓝边 */}
  <button
    onClick={() => navigate('/admin/meeting-documents/new')}
    className="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 border border-blue-600 dark:border-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors"
  >
    <FileText className="h-5 w-5" />
    创建会议文档
  </button>
  
  {/* 创建会议按钮 - 蓝底白字 */}
  <button
    onClick={() => setShowCreateModal(true)}
    className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
  >
    <Plus className="h-5 w-5" />
    创建会议
  </button>
</div>
```

### 4. 配置路由

**文件位置**: `src/AppRoutes.tsx`

**新增路由**:
```tsx
// 导入组件
import MeetingDocumentEditorPage from './pages/admin/MeetingDocumentEditorPage';

// 路由配置
<Route path="meeting-documents/new" element={<MeetingDocumentEditorPage />} />
<Route path="meeting-documents/:id" element={<MeetingDocumentEditorPage />} />
```

**路由说明**:
- `/admin/meeting-documents/new`: 创建新文档
- `/admin/meeting-documents/:id`: 编辑现有文档

## 🎯 用户体验

### 完整操作流程

1. **进入会议管理页面**
   - 访问 `/admin/meetings`
   - 看到"创建会议文档"和"创建会议"两个按钮

2. **点击"创建会议文档"**
   - 跳转到全屏编辑器页面
   - URL: `/admin/meeting-documents/new`

3. **编辑文档**
   - 输入文档标题
   - 使用 Tiptap 编辑器编写内容
   - 支持富文本格式(加粗、斜体、列表、链接等)

4. **保存文档**
   - 点击"保存"按钮
   - 数据保存到 Supabase
   - 自动跳转到编辑模式(URL 变为 `/admin/meeting-documents/:id`)

5. **后续编辑**
   - 可以继续编辑和保存
   - 每次保存会更新 `updated_at` 时间戳

6. **返回列表**
   - 点击左上角"返回"按钮
   - 回到会议管理列表页面

### 按钮样式对比

| 按钮 | 背景色 | 文字色 | 边框 | 图标 | 用途 |
|------|--------|--------|------|------|------|
| 创建会议文档 | 白色 | 蓝色 | 蓝色边框 | 📄 FileText | 创建独立文档 |
| 创建会议 | 蓝色 | 白色 | 无 | ➕ Plus | 创建会议记录 |

### 设计理念

- **主次分明**: "创建会议"是主要操作(实心蓝色),"创建会议文档"是次要操作(空心蓝色)
- **视觉协调**: 两个按钮颜色主题一致,都是蓝色系
- **功能区分**: 图标和文字清晰区分两种不同的功能

## ✨ 功能特点

### 1. 全屏编辑体验
- 无侧边栏干扰
- 最大化编辑区域
- 沉浸式写作体验

### 2. 智能保存
- 新建文档时,保存后自动跳转到编辑模式
- 编辑模式下,保存会更新现有文档
- URL 反映当前状态(new vs 文档ID)

### 3. 富文本支持
- 使用 Tiptap 编辑器
- 支持多种格式:
  - 文本格式(加粗、斜体、下划线、删除线)
  - 标题(H1-H6)
  - 列表(有序、无序、任务列表)
  - 链接、图片
  - 代码块、引用
  - 表格
  - 高亮

### 4. 响应式设计
- 适配不同屏幕尺寸
- 移动端友好

### 5. 数据持久化
- 自动保存到 Supabase
- 记录创建人、创建时间、更新时间
- 外键关联员工表

### 6. 状态反馈
- 保存中状态显示(Loading 动画)
- 保存成功提示
- 加载失败错误处理

## 🔧 技术实现

### 数据流

```
用户操作 → React State → Supabase → 数据库
  ↓
标题输入 → setTitle
编辑器 → setContent → RichTextEditor onChange
保存按钮 → handleSave → supabase.insert/update
  ↓
成功 → 跳转/刷新
失败 → 错误提示
```

### 状态管理

```tsx
const [title, setTitle] = useState('');        // 文档标题
const [content, setContent] = useState('');    // 文档内容
const [saving, setSaving] = useState(false);   // 保存中状态
const [loading, setLoading] = useState(isEditMode); // 加载状态
```

### 编辑模式判断

```tsx
const { id } = useParams<{ id: string }>();
const isEditMode = !!id;  // 有 id 参数表示编辑模式

if (isEditMode && id) {
  // 编辑现有文档
  loadDocument();
} else {
  // 创建新文档
  // 无需加载
}
```

### 自动跳转逻辑

```tsx
// 创建新文档成功后
const { data } = await supabase
  .from('meeting_documents')
  .insert({ ... })
  .select()
  .single();

if (data) {
  // 跳转到编辑模式,使用 replace 避免在历史记录中留下 /new
  navigate(`/admin/meeting-documents/${data.id}`, { replace: true });
}
```

## 📱 界面展示

### 会议管理页面顶部
```
┌──────────────────────────────────────────────────────┐
│ 会议管理                                              │
│ 管理和跟踪所有会议记录                                │
│                              [📄 创建会议文档] [➕ 创建会议] │
└──────────────────────────────────────────────────────┘
```

### 文档编辑器页面
```
┌──────────────────────────────────────────────────────┐
│ [← 返回] 📄 输入文档标题...              [💾 保存]    │ <- 固定顶栏
├──────────────────────────────────────────────────────┤
│                                                      │
│  [B] [I] [U] [H1] [H2] [•] [1.] [🔗] [📷] [</>] ...  │ <- 工具栏
│  ────────────────────────────────────────────────    │
│                                                      │
│  开始编写会议文档...                                  │
│                                                      │
│                                                      │
│                                                      │
│                                                      │
│                                                      │
└──────────────────────────────────────────────────────┘
```

## 🎉 完成状态

✅ 创建 `meeting_documents` 数据表
✅ 创建 `MeetingDocumentEditorPage` 页面
✅ 在 `MeetingsPage` 添加"创建会议文档"按钮
✅ 配置路由(new + :id)
✅ 集成 Tiptap 富文本编辑器
✅ 实现新建和编辑功能
✅ 实现自动保存和跳转
✅ 无 Lint 错误
✅ 响应式设计

## 🔄 与"创建会议"的区别

| 特性 | 创建会议 | 创建会议文档 |
|------|----------|--------------|
| 触发方式 | 点击"创建会议"按钮 | 点击"创建会议文档"按钮 |
| 界面形式 | 模态框(弹窗) | 独立全屏页面 |
| 主要用途 | 记录会议基本信息 | 编写详细文档 |
| 编辑器 | 简单表单 | Tiptap 富文本 |
| 存储表 | `meetings` | `meeting_documents` |
| 字段 | 标题、类型、时间、参会人、议程、纪要 | 标题、内容 |
| 使用场景 | 会议安排和记录 | 独立的会议文档、总结报告 |

---

**创建时间**: 2024-01-15
**功能状态**: ✅ 已完成并测试
**数据表**: `meeting_documents`
**页面**: `MeetingDocumentEditorPage.tsx`
**路由**: `/admin/meeting-documents/new`, `/admin/meeting-documents/:id`

