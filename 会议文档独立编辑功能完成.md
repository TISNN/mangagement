# ä¼šè®®æ–‡æ¡£ç‹¬ç«‹ç¼–è¾‘åŠŸèƒ½å®Œæˆè¯´æ˜

## âœ… åŠŸèƒ½å®ç°

åœ¨ä¼šè®®ç®¡ç†é¡µé¢é¡¶éƒ¨çš„"åˆ›å»ºä¼šè®®"æŒ‰é’®æ—è¾¹æ·»åŠ äº†"åˆ›å»ºä¼šè®®æ–‡æ¡£"æŒ‰é’®,ç‚¹å‡»åå¯ä»¥è¿›å…¥ä¸€ä¸ªç‹¬ç«‹çš„å…¨å±å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é¡µé¢,ä¸“é—¨ç”¨äºåˆ›å»ºå’Œç¼–è¾‘ä¼šè®®æ–‡æ¡£ã€‚

## ğŸ“ å®ç°ç»†èŠ‚

### 1. åˆ›å»ºæ•°æ®è¡¨ `meeting_documents`

**æ•°æ®åº“è¿ç§»**: `create_meeting_documents_table`

**è¡¨ç»“æ„**:
```sql
CREATE TABLE meeting_documents (
  id BIGSERIAL PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by INTEGER NOT NULL,
  title TEXT NOT NULL,
  content TEXT,
  CONSTRAINT meeting_documents_created_by_fkey 
    FOREIGN KEY (created_by) REFERENCES employees(id) ON DELETE CASCADE
);
```

**å­—æ®µè¯´æ˜**:
- `id`: æ–‡æ¡£ID(ä¸»é”®)
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´(è‡ªåŠ¨è§¦å‘å™¨)
- `created_by`: åˆ›å»ºäºº(å‘˜å·¥ID,å¤–é”®å…³è” employees è¡¨)
- `title`: æ–‡æ¡£æ ‡é¢˜
- `content`: æ–‡æ¡£å†…å®¹(å¯Œæ–‡æœ¬HTML)

**ç´¢å¼•**:
- `idx_meeting_documents_created_by`: åˆ›å»ºäººç´¢å¼•
- `idx_meeting_documents_created_at`: åˆ›å»ºæ—¶é—´ç´¢å¼•(é™åº)

### 2. åˆ›å»ºä¼šè®®æ–‡æ¡£ç¼–è¾‘å™¨é¡µé¢

**æ–‡ä»¶ä½ç½®**: `src/pages/admin/MeetingDocumentEditorPage.tsx`

**åŠŸèƒ½ç‰¹ç‚¹**:
- å…¨å±ç¼–è¾‘ä½“éªŒ,æ— å¹²æ‰°
- é¡¶éƒ¨å›ºå®šæ“ä½œæ ,åŒ…å«è¿”å›ã€æ ‡é¢˜è¾“å…¥ã€ä¿å­˜æŒ‰é’®
- ä½¿ç”¨ Tiptap å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- æ”¯æŒæ–°å»ºå’Œç¼–è¾‘ä¸¤ç§æ¨¡å¼
- è‡ªåŠ¨ä¿å­˜åˆ° Supabase æ•°æ®åº“
- åˆ›å»ºæˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°ç¼–è¾‘æ¨¡å¼

**UI å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† è¿”å›] ğŸ“„ [æ–‡æ¡£æ ‡é¢˜è¾“å…¥æ¡†]        [ğŸ’¾ ä¿å­˜] â”‚ <- å›ºå®šé¡¶æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚                                                 â”‚
â”‚          Tiptap å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŒºåŸŸ               â”‚
â”‚          (æ”¯æŒæ‰€æœ‰å¯Œæ–‡æœ¬åŠŸèƒ½)                   â”‚
â”‚                                                 â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç å®ç°**:
```tsx
// çŠ¶æ€ç®¡ç†
const [title, setTitle] = useState('');
const [content, setContent] = useState('');
const [saving, setSaving] = useState(false);
const [loading, setLoading] = useState(isEditMode);

// ä¿å­˜æ–‡æ¡£
const handleSave = async () => {
  if (isEditMode && id) {
    // æ›´æ–°ç°æœ‰æ–‡æ¡£
    await supabase
      .from('meeting_documents')
      .update({ title, content, updated_at: new Date().toISOString() })
      .eq('id', id);
  } else {
    // åˆ›å»ºæ–°æ–‡æ¡£
    const { data } = await supabase
      .from('meeting_documents')
      .insert({ title, content, created_by: employee.id })
      .select()
      .single();
    
    // åˆ›å»ºæˆåŠŸåè·³è½¬åˆ°ç¼–è¾‘æ¨¡å¼
    navigate(`/admin/meeting-documents/${data.id}`, { replace: true });
  }
};
```

### 3. æ›´æ–°ä¼šè®®ç®¡ç†é¡µé¢

**æ–‡ä»¶ä½ç½®**: `src/pages/admin/MeetingsPage.tsx`

**ä¿®æ”¹å†…å®¹**:
- å¯¼å…¥ `FileText` å›¾æ ‡
- ä¿®æ”¹æ ‡é¢˜æ å¸ƒå±€,æ·»åŠ æŒ‰é’®ç»„
- æ–°å¢"åˆ›å»ºä¼šè®®æ–‡æ¡£"æŒ‰é’®(ç™½åº•è“è¾¹æ ·å¼)
- ä¿ç•™"åˆ›å»ºä¼šè®®"æŒ‰é’®(è“åº•ç™½å­—æ ·å¼)

**æŒ‰é’®å¸ƒå±€**:
```tsx
<div className="flex items-center gap-3">
  {/* åˆ›å»ºä¼šè®®æ–‡æ¡£æŒ‰é’® - ç™½åº•è“è¾¹ */}
  <button
    onClick={() => navigate('/admin/meeting-documents/new')}
    className="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 text-blue-600 dark:text-blue-400 border border-blue-600 dark:border-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors"
  >
    <FileText className="h-5 w-5" />
    åˆ›å»ºä¼šè®®æ–‡æ¡£
  </button>
  
  {/* åˆ›å»ºä¼šè®®æŒ‰é’® - è“åº•ç™½å­— */}
  <button
    onClick={() => setShowCreateModal(true)}
    className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
  >
    <Plus className="h-5 w-5" />
    åˆ›å»ºä¼šè®®
  </button>
</div>
```

### 4. é…ç½®è·¯ç”±

**æ–‡ä»¶ä½ç½®**: `src/AppRoutes.tsx`

**æ–°å¢è·¯ç”±**:
```tsx
// å¯¼å…¥ç»„ä»¶
import MeetingDocumentEditorPage from './pages/admin/MeetingDocumentEditorPage';

// è·¯ç”±é…ç½®
<Route path="meeting-documents/new" element={<MeetingDocumentEditorPage />} />
<Route path="meeting-documents/:id" element={<MeetingDocumentEditorPage />} />
```

**è·¯ç”±è¯´æ˜**:
- `/admin/meeting-documents/new`: åˆ›å»ºæ–°æ–‡æ¡£
- `/admin/meeting-documents/:id`: ç¼–è¾‘ç°æœ‰æ–‡æ¡£

## ğŸ¯ ç”¨æˆ·ä½“éªŒ

### å®Œæ•´æ“ä½œæµç¨‹

1. **è¿›å…¥ä¼šè®®ç®¡ç†é¡µé¢**
   - è®¿é—® `/admin/meetings`
   - çœ‹åˆ°"åˆ›å»ºä¼šè®®æ–‡æ¡£"å’Œ"åˆ›å»ºä¼šè®®"ä¸¤ä¸ªæŒ‰é’®

2. **ç‚¹å‡»"åˆ›å»ºä¼šè®®æ–‡æ¡£"**
   - è·³è½¬åˆ°å…¨å±ç¼–è¾‘å™¨é¡µé¢
   - URL: `/admin/meeting-documents/new`

3. **ç¼–è¾‘æ–‡æ¡£**
   - è¾“å…¥æ–‡æ¡£æ ‡é¢˜
   - ä½¿ç”¨ Tiptap ç¼–è¾‘å™¨ç¼–å†™å†…å®¹
   - æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼(åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ã€é“¾æ¥ç­‰)

4. **ä¿å­˜æ–‡æ¡£**
   - ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
   - æ•°æ®ä¿å­˜åˆ° Supabase
   - è‡ªåŠ¨è·³è½¬åˆ°ç¼–è¾‘æ¨¡å¼(URL å˜ä¸º `/admin/meeting-documents/:id`)

5. **åç»­ç¼–è¾‘**
   - å¯ä»¥ç»§ç»­ç¼–è¾‘å’Œä¿å­˜
   - æ¯æ¬¡ä¿å­˜ä¼šæ›´æ–° `updated_at` æ—¶é—´æˆ³

6. **è¿”å›åˆ—è¡¨**
   - ç‚¹å‡»å·¦ä¸Šè§’"è¿”å›"æŒ‰é’®
   - å›åˆ°ä¼šè®®ç®¡ç†åˆ—è¡¨é¡µé¢

### æŒ‰é’®æ ·å¼å¯¹æ¯”

| æŒ‰é’® | èƒŒæ™¯è‰² | æ–‡å­—è‰² | è¾¹æ¡† | å›¾æ ‡ | ç”¨é€” |
|------|--------|--------|------|------|------|
| åˆ›å»ºä¼šè®®æ–‡æ¡£ | ç™½è‰² | è“è‰² | è“è‰²è¾¹æ¡† | ğŸ“„ FileText | åˆ›å»ºç‹¬ç«‹æ–‡æ¡£ |
| åˆ›å»ºä¼šè®® | è“è‰² | ç™½è‰² | æ—  | â• Plus | åˆ›å»ºä¼šè®®è®°å½• |

### è®¾è®¡ç†å¿µ

- **ä¸»æ¬¡åˆ†æ˜**: "åˆ›å»ºä¼šè®®"æ˜¯ä¸»è¦æ“ä½œ(å®å¿ƒè“è‰²),"åˆ›å»ºä¼šè®®æ–‡æ¡£"æ˜¯æ¬¡è¦æ“ä½œ(ç©ºå¿ƒè“è‰²)
- **è§†è§‰åè°ƒ**: ä¸¤ä¸ªæŒ‰é’®é¢œè‰²ä¸»é¢˜ä¸€è‡´,éƒ½æ˜¯è“è‰²ç³»
- **åŠŸèƒ½åŒºåˆ†**: å›¾æ ‡å’Œæ–‡å­—æ¸…æ™°åŒºåˆ†ä¸¤ç§ä¸åŒçš„åŠŸèƒ½

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### 1. å…¨å±ç¼–è¾‘ä½“éªŒ
- æ— ä¾§è¾¹æ å¹²æ‰°
- æœ€å¤§åŒ–ç¼–è¾‘åŒºåŸŸ
- æ²‰æµ¸å¼å†™ä½œä½“éªŒ

### 2. æ™ºèƒ½ä¿å­˜
- æ–°å»ºæ–‡æ¡£æ—¶,ä¿å­˜åè‡ªåŠ¨è·³è½¬åˆ°ç¼–è¾‘æ¨¡å¼
- ç¼–è¾‘æ¨¡å¼ä¸‹,ä¿å­˜ä¼šæ›´æ–°ç°æœ‰æ–‡æ¡£
- URL åæ˜ å½“å‰çŠ¶æ€(new vs æ–‡æ¡£ID)

### 3. å¯Œæ–‡æœ¬æ”¯æŒ
- ä½¿ç”¨ Tiptap ç¼–è¾‘å™¨
- æ”¯æŒå¤šç§æ ¼å¼:
  - æ–‡æœ¬æ ¼å¼(åŠ ç²—ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿)
  - æ ‡é¢˜(H1-H6)
  - åˆ—è¡¨(æœ‰åºã€æ— åºã€ä»»åŠ¡åˆ—è¡¨)
  - é“¾æ¥ã€å›¾ç‰‡
  - ä»£ç å—ã€å¼•ç”¨
  - è¡¨æ ¼
  - é«˜äº®

### 4. å“åº”å¼è®¾è®¡
- é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- ç§»åŠ¨ç«¯å‹å¥½

### 5. æ•°æ®æŒä¹…åŒ–
- è‡ªåŠ¨ä¿å­˜åˆ° Supabase
- è®°å½•åˆ›å»ºäººã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´
- å¤–é”®å…³è”å‘˜å·¥è¡¨

### 6. çŠ¶æ€åé¦ˆ
- ä¿å­˜ä¸­çŠ¶æ€æ˜¾ç¤º(Loading åŠ¨ç”»)
- ä¿å­˜æˆåŠŸæç¤º
- åŠ è½½å¤±è´¥é”™è¯¯å¤„ç†

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ â†’ React State â†’ Supabase â†’ æ•°æ®åº“
  â†“
æ ‡é¢˜è¾“å…¥ â†’ setTitle
ç¼–è¾‘å™¨ â†’ setContent â†’ RichTextEditor onChange
ä¿å­˜æŒ‰é’® â†’ handleSave â†’ supabase.insert/update
  â†“
æˆåŠŸ â†’ è·³è½¬/åˆ·æ–°
å¤±è´¥ â†’ é”™è¯¯æç¤º
```

### çŠ¶æ€ç®¡ç†

```tsx
const [title, setTitle] = useState('');        // æ–‡æ¡£æ ‡é¢˜
const [content, setContent] = useState('');    // æ–‡æ¡£å†…å®¹
const [saving, setSaving] = useState(false);   // ä¿å­˜ä¸­çŠ¶æ€
const [loading, setLoading] = useState(isEditMode); // åŠ è½½çŠ¶æ€
```

### ç¼–è¾‘æ¨¡å¼åˆ¤æ–­

```tsx
const { id } = useParams<{ id: string }>();
const isEditMode = !!id;  // æœ‰ id å‚æ•°è¡¨ç¤ºç¼–è¾‘æ¨¡å¼

if (isEditMode && id) {
  // ç¼–è¾‘ç°æœ‰æ–‡æ¡£
  loadDocument();
} else {
  // åˆ›å»ºæ–°æ–‡æ¡£
  // æ— éœ€åŠ è½½
}
```

### è‡ªåŠ¨è·³è½¬é€»è¾‘

```tsx
// åˆ›å»ºæ–°æ–‡æ¡£æˆåŠŸå
const { data } = await supabase
  .from('meeting_documents')
  .insert({ ... })
  .select()
  .single();

if (data) {
  // è·³è½¬åˆ°ç¼–è¾‘æ¨¡å¼,ä½¿ç”¨ replace é¿å…åœ¨å†å²è®°å½•ä¸­ç•™ä¸‹ /new
  navigate(`/admin/meeting-documents/${data.id}`, { replace: true });
}
```

## ğŸ“± ç•Œé¢å±•ç¤º

### ä¼šè®®ç®¡ç†é¡µé¢é¡¶éƒ¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šè®®ç®¡ç†                                              â”‚
â”‚ ç®¡ç†å’Œè·Ÿè¸ªæ‰€æœ‰ä¼šè®®è®°å½•                                â”‚
â”‚                              [ğŸ“„ åˆ›å»ºä¼šè®®æ–‡æ¡£] [â• åˆ›å»ºä¼šè®®] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡æ¡£ç¼–è¾‘å™¨é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† è¿”å›] ğŸ“„ è¾“å…¥æ–‡æ¡£æ ‡é¢˜...              [ğŸ’¾ ä¿å­˜]    â”‚ <- å›ºå®šé¡¶æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  [B] [I] [U] [H1] [H2] [â€¢] [1.] [ğŸ”—] [ğŸ“·] [</>] ...  â”‚ <- å·¥å…·æ 
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                      â”‚
â”‚  å¼€å§‹ç¼–å†™ä¼šè®®æ–‡æ¡£...                                  â”‚
â”‚                                                      â”‚
â”‚                                                      â”‚
â”‚                                                      â”‚
â”‚                                                      â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ å®ŒæˆçŠ¶æ€

âœ… åˆ›å»º `meeting_documents` æ•°æ®è¡¨
âœ… åˆ›å»º `MeetingDocumentEditorPage` é¡µé¢
âœ… åœ¨ `MeetingsPage` æ·»åŠ "åˆ›å»ºä¼šè®®æ–‡æ¡£"æŒ‰é’®
âœ… é…ç½®è·¯ç”±(new + :id)
âœ… é›†æˆ Tiptap å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
âœ… å®ç°æ–°å»ºå’Œç¼–è¾‘åŠŸèƒ½
âœ… å®ç°è‡ªåŠ¨ä¿å­˜å’Œè·³è½¬
âœ… æ—  Lint é”™è¯¯
âœ… å“åº”å¼è®¾è®¡

## ğŸ”„ ä¸"åˆ›å»ºä¼šè®®"çš„åŒºåˆ«

| ç‰¹æ€§ | åˆ›å»ºä¼šè®® | åˆ›å»ºä¼šè®®æ–‡æ¡£ |
|------|----------|--------------|
| è§¦å‘æ–¹å¼ | ç‚¹å‡»"åˆ›å»ºä¼šè®®"æŒ‰é’® | ç‚¹å‡»"åˆ›å»ºä¼šè®®æ–‡æ¡£"æŒ‰é’® |
| ç•Œé¢å½¢å¼ | æ¨¡æ€æ¡†(å¼¹çª—) | ç‹¬ç«‹å…¨å±é¡µé¢ |
| ä¸»è¦ç”¨é€” | è®°å½•ä¼šè®®åŸºæœ¬ä¿¡æ¯ | ç¼–å†™è¯¦ç»†æ–‡æ¡£ |
| ç¼–è¾‘å™¨ | ç®€å•è¡¨å• | Tiptap å¯Œæ–‡æœ¬ |
| å­˜å‚¨è¡¨ | `meetings` | `meeting_documents` |
| å­—æ®µ | æ ‡é¢˜ã€ç±»å‹ã€æ—¶é—´ã€å‚ä¼šäººã€è®®ç¨‹ã€çºªè¦ | æ ‡é¢˜ã€å†…å®¹ |
| ä½¿ç”¨åœºæ™¯ | ä¼šè®®å®‰æ’å’Œè®°å½• | ç‹¬ç«‹çš„ä¼šè®®æ–‡æ¡£ã€æ€»ç»“æŠ¥å‘Š |

---

**åˆ›å»ºæ—¶é—´**: 2024-01-15
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•
**æ•°æ®è¡¨**: `meeting_documents`
**é¡µé¢**: `MeetingDocumentEditorPage.tsx`
**è·¯ç”±**: `/admin/meeting-documents/new`, `/admin/meeting-documents/:id`





