# CRM Center · 跟进记录（Engagement Desk）设计文档

## 1. 模块定位
- **所属导航**：`CRM Center / Engagement Desk`
- **核心任务**：集中展示和管理所有客户沟通记录，保障跟进及时、信息完整，并提供 AI 辅助提升沟通质量。
- **访问角色**：销售顾问、客服、销售经理、质检专员、AI Copilot。

## 2. 信息架构
```
Engagement Desk
├─ 顶部状态栏
│  ├ 今日待办 / 已完成 / 延期跟进
│  ├ 沟通渠道占比（电话/邮件/社交/会议）
├─ 时间轴视图（Timeline）
│  ├ 全渠道记录列表
│  ├ AI 摘要侧栏
│  ├ 搜索过滤工具栏
├─ 任务与提醒面板
│  ├ 嵌入式任务卡片
│  ├ SLA 提醒
│  └ 升级/转派操作
├─ 模板与话术库
│  ├ 常用话术 / 回访脚本
│  ├ AI 生成回复
│  └ 质检评分结果
└─ 质检监控区（经理视角）
   ├ 合规检查
   ├ 通话评分
   ├ 反馈与培训跟进
```

## 3. 关键场景

### 3.1 顾问记录沟通
1. 选择客户或线索，时间轴自动定位至最新记录。
2. 点击“新增记录”，选择渠道（电话、邮件、会议、面访）。
3. 填写/上传内容（文字、附件、录音），可勾选“同步到任务”创建后续跟进。
4. 系统调用 AI：生成摘要要点、客户情绪、下一步建议；顾问可编辑后保存。
5. 记录保存后自动更新客户最新互动时间，触发 SLA reset。

### 3.2 自动记录——邮件/通话
- 邮件：通过 IMAP/OAuth 自动拉取相关邮件，解析发件人/收件人匹配客户。
- 通话：呼叫系统完成后推送录音文件，AI 自动转换文字与摘要。
- 微信/WhatsApp：集成第三方服务或手动粘贴对话内容，提供模板化嵌入。

### 3.3 经理质检
1. 进入质检视图，筛选“高风险”或“随机抽检”列表。
2. 打开记录详情，查看 AI 标注的风险点、高频词、是否使用禁语。
3. 可对记录打分、添加反馈（建议/要求），系统推送给顾问。
4. 若发现重大问题，可一键创建培训任务或升级到合规部门。

### 3.4 风险预警
- 当 24 小时无跟进或客户投诉时，自动在时间轴顶部出现红色提醒。
- 若同一客户多次表达不满，系统聚合成风险标签，提示经理介入。

## 4. 数据模型
- `Engagement`：记录主体（id、lead_id/customer_id、channel、content、owner、duration、sentiment、summary、next_action、created_at、attachments[]）。
- `EngagementTask`：关联任务（engagement_id、assignee_id、due_date、status、reminder_config）。
- `EngagementQuality`：质检结果（engagement_id、score、issues、reviewer、feedback、status）。
- `Template`：话术/脚本（id、title、channel、content、tags、created_by、rating）。
- `SLAStatus`：跟进 SLA（entity_id、last_engagement_at、next_due，escalation_level）。

## 5. API 草案
| 功能 | Method | Endpoint | 说明 |
|------|--------|----------|------|
| 获取时间轴 | GET | `/api/crm/engagements?lead_id=` | 支持渠道、日期、关键词过滤 |
| 新增记录 | POST | `/api/crm/engagements` | body 含 channel、content、attachments、tasks |
| 上传录音 | POST | `/api/crm/engagements/:id/attachments` | 支持音频、文档 |
| 生成 AI 摘要 | POST | `/api/crm/engagements/:id/ai-summary` | 返回摘要、情绪、TODO |
| 创建/更新任务 | POST/PATCH | `/api/crm/tasks` | 跟进任务、提醒配置 |
| 获取质检列表 | GET | `/api/crm/engagements/quality` | 筛选待质检、评分、问题类型 |
| 提交质检结果 | POST | `/api/crm/engagements/:id/quality` | 记录评分、反馈 |
| 获取模板库 | GET | `/api/crm/templates` | 搜索/分类话术 |

## 6. 界面与交互
- 时间轴按天分组，支持“展开/折叠历史”，每条记录展示：渠道图标、时间、执行人、摘要、标签（如“AI”）。
- 点击记录打开侧边抽屉：详情、附件、AI 摘要、任务列表、质检评分。
- “新增记录”弹窗提供富文本编辑、附件拖拽、模板插入、AI 草拟。
- 任务面板显示状态（待办、进行中、完成），可拖拽调整优先级。
- 模板库支持搜索、标签、收藏，与 AI 结合自动推荐适合话术。

## 7. 自动化规则示例
- 邮件主题包含“预约确认”，自动创建“安排会议”任务。
- 通话内容提到“预算有限”时，自动添加标签并提醒经理介入。
- 会议纪要上传后，AI 自动提取行动项并生成任务分配建议。
- 若客户一周内多次提及“退款”“投诉”，推送风险预警给客服经理。

## 8. 指标与埋点
- 记录数量、渠道占比、平均响应时长、SLA 达成率。
- AI 摘要生成次数、采纳率、修改率。
- 质检评分分布、合规问题类型、反馈处理时长。
- 模板使用频率、AI 草稿发送率、自动任务完成率。
- 用户行为：新增记录频率、过滤器使用、附件上传量。

## 9. 权限
- 顾问：管理自己负责客户的记录，可查看团队共享记录（只读）。
- 经理：查看团队所有记录、质检评分、任务状态；可调整任务、分派。
- 质检：访问录音/纪要、创建评分、发布反馈。
- 市场/客服：只读共享信息，无法编辑销售记录。
- 所有操作写入审计日志（新增/编辑/删除/质检）。

## 10. 迭代计划
1. **MVP**：全渠道记录、手动录入、附件上传、任务提醒、基础过滤。
2. **阶段二**：AI 摘要、语音转文字、邮件/电话集成、风险预警。
3. **阶段三**：质检模型、模板推荐、SLA 自动升级。
4. **阶段四**：智能跟进建议、情绪分析报表、跨模块自动化（与服务进度、文书板衔接）。

---
后续可扩展“客户会议纪要协作文档”“跨团队共享空间”等高级功能，以支持更复杂的顾问协作流程。
