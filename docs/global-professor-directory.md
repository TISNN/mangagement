# 全球教授库功能说明

## 这个功能是做什么的？

全球教授库就像一座“国际老师图书馆”。顾问和学生可以在这里快速找到海外大学的教授，了解他们教什么课、研究什么主题，以及怎样联系到他们，方便后续做选校、科研申请或合作。

## 谁会用它？

- 学生：想找科研导师、申请交流项目或学术合作的同学。
- 顾问老师：帮学生匹配合适教授、准备申请材料的老师。
- 运营同学：维护教授信息、监控数据质量的后台同事。

## 核心页面与内容

1. 教授总览页  
   - 提供国家、学校、研究方向等筛选器。  
   - 支持关键字搜索教授姓名或论文主题。  
   - 内置“博士申请筛选器”：快速过滤当前开放博士招生、是否提供奖学金、合作形式（联合培养/直博）、目标入学年份。  
   - 每张卡片展示头像、名字、学校、研究方向关键词、最近成果，并高亮“博士招生状态”“是否有全奖”。  
   - 右侧有“收藏”“分享”“加入学生方案”快捷按钮。

2. 教授详情页  
   - 展示详细资料：联系方式、主页链接、教育背景、授课课程、代表论文、合作过的学生案例。  
   - 清晰罗列博士招生信息：导师招生偏好、近五年招生人数、学生毕业去向、是否接受跨专业、语言/考试要求、是否需要科研成果。  
   - 提供“顾问笔记”区域，支持内部记录沟通要点。  
   - 内置“发送邮件模版”与“预约会谈”入口，便于立即行动。  
   - 显示系统生成的“匹配建议”：例如适合的学生类型、合作注意事项。

3. 收藏与分享页  
   - 顾问可整理多位教授成为一个“教授清单”，与学生共享。  
   - 支持导出 PDF / Excel，或直接写入学生档案。  
   - 显示收藏来源、创建人、最近更新时间，便于协作。

## 主要功能点

- **多条件筛选与排序**：国家、学校、学院、研究方向、合作类型、评分、更新时间。  
- **博士专用条件**：招生年份、是否接受国际博士、奖学金充足度、导师带博士人数上限、联合培养机会。  
- **快速搜索**：模糊检索教授姓名、研究关键词、论文标题。  
- **教授卡片标签**：标记语言、是否接受国际学生、在招项目状态、奖学金类型。  
- **一键收藏/分享**：顾问一键把教授加入自定义清单。  
- **匹配助手**：基于学生背景（专业、成绩、兴趣）给出 1-3 位推荐教授。  
- **数据更新提醒**：教授资料 90 天未更新时提醒运营同学检查。  
- **访问日志**：记录谁浏览、收藏或导出，方便追踪使用情况。

## 需要保存哪些数据？

| 字段 | 解释 | 说明 |
| ---- | ---- | ---- |
| professor_id | 教授唯一编号 | 主键（bigint） |
| name | 教授姓名 | 支持英文名与中文名 |
| photo_url | 头像链接 | 可为空 |
| university | 所在学校 | 例如 “MIT” |
| college | 学院/系 | 例如 “工程学院” |
| country | 国家/地区 | 例如 “美国” |
| research_tags | 研究方向标签数组 | 例如 ["人工智能","教育技术"] |
| signature_projects | 重点项目列表 | 用于展示教授近期研究方向 |
| contact_email | 官方邮箱 | 用于联络 |
| personal_page | 主页链接 | 网址 |
| publications | 代表论文列表 | JSONB，包含标题、年份、链接 |
| accepts_students | 是否接受国际学生 | 布尔值 |
| phd_supervision_status | 博士招生状态 | 例如 “开放2026 Fall”“暂不招收博士” |
| phd_requirements | 博士申请要求 | JSONB，包含语言、GPA、科研经历、推荐信等 |
| funding_options | 资助/奖学金情况 | JSONB，数组结构（type、description） |
| funding_types | 资助类型数组 | 用于快速筛选（全额/部分/名额有限） |
| intake | 招生入学季 | 例如 “2026 Fall” |
| application_window | 申请窗口 | JSONB，包含开始/截止日期 |
| recent_phd_placements | 最近博士去向 | JSONB 列表，记录年份、去向、亮点 |
| match_score | 匹配度 | 0-100，供列表排序 |
| response_time | 邮件回复速度 | 例如 “平均 6 天回复” |
| last_reviewed_at | 最近审核日期 | 数据质量监控 |
| notes_internal | 顾问内部备注 | 富文本 |

同时配合以下两张关联表：
- `professor_match_records`：记录某位教授被推荐给哪些学生、后续状态。  
- `professor_favorites`：顾问收藏关系（原“收藏清单”），支持去重和个人隔离。

### Supabase 表结构落地

- `public.professors`：承载上述字段的核心主表，使用 `bigserial` 主键，`research_tags`、`funding_types` 使用 GIN 索引，`trigger_set_timestamp` 负责维护 `updated_at`。  
- `public.professor_favorites`：顾问收藏清单，字段 `professor_id`、`employee_id`、`created_at`，复合唯一约束防重复，RLS 限定“仅本人可读写”。  
- `public.professor_match_records`：导师匹配记录，字段 `professor_id`、`student_id`、`employee_id`、`target_intake`、`custom_note`、`status`，RLS 同样限定创建者可见。  
- 种子数据：迁移 `20251112_seed_professors` 已导入 10 位示例教授，方便页面开箱体验。

## 页面流程（文字示意）

1. 顾问进入“教授库” → 看到默认列表（按热门学校排序）。  
2. 顾问开启“博士申请模式” → 按招生年份、奖学金类型、研究方向过滤 → 列表即时过滤。  
3. 查看教授卡片上的“博士招生状态”“推荐匹配指数”，快速判断优先级。  
4. 点击某位教授 → 打开详情页，查看招生要求、科研方向、过往博士案例、联系方式。  
5. 觉得合适 → 点击“加入学生方案”，选择学生并写备注，自动生成待沟通任务。  
6. 系统记录此次匹配，并在学生档案、申请工作台同步教授信息。

## 技术实现建议

- **前端**  
  - `ProfessorDirectoryPage` 统一协调筛选、列表、收藏、详情、匹配弹窗，所有数据请求集中于 `professorDirectoryService`。  
  - 通过 `DoctoralFiltersPanel`、`MatchInsightsPanel`、`ProfessorGrid`、`ShortlistPanel`、`ProfessorMatchDrawer` 等组件划分展示/操作逻辑，便于后续扩展。  
  - 采用惰性加载 + 缓存：列表刷新会写入内存缓存，收藏面板缺失数据时按需拉取详情。  
  - 所有重要操作（收藏、导出、匹配）统一反馈/错误处理，兼容暗色主题。

- **后端 / 数据**  
  - 依赖 Supabase 托管 `professors`/`professor_favorites`/`professor_match_records`，使用迁移脚本维护结构、索引与 RLS 策略。  
  - 建议定期从高校官网/合作渠道同步教授数据，可通过 Supabase Edge Function 或外部 ETL 实现。  
  - 对关键字段（如 `last_reviewed_at`、`funding_options`）设置告警/提醒逻辑，保障数据时效性。  
  - 结合 `audit_logs` 记录收藏、匹配等写操作，便于追踪与合规审计。

- **监控与安全**  
  - 针对收藏、匹配等关键操作写入 `event_logs`，异常时发送告警。  
  - 保护教授邮箱、内部备注，确保仅授权顾问可见。  
  - 导出功能限制单次条目数量，防止批量泄露。

## 后续可以升级的点

- 接入教授线上日程，支持直接预约会议。  
- 结合 AI 自动总结教授研究方向、最近热点论文。  
- 与学生服务模块打通，自动生成“教授跟进任务”，并根据博士申请时间节点推送提醒。  
- 对接高校官网数据，定期同步最新职位变动。  
- 增加“教授合作成功案例”板块，展示历史成果，增强学生信心。

--

如需开始开发，可先用 30 条示例数据在 Supabase 建表测试，再逐步接入真实信息。

## 当前前端落地状态（2025-11-12）

- 页面路径：`/admin/professor-directory`，位于“留学服务”导航组。  
- 主要组件：  
  - `DoctoralFiltersPanel`：负责国家 → 院校 → 研究标签层级筛选，控制排序、资助、入学季、国际生切换。  
  - `MatchInsightsPanel`：实时输出匹配概览（数量、匹配度、国际友好度、全奖占比），提供导出、保存方案按钮。  
  - `ProfessorGrid` / `ProfessorCard`：渲染 Supabase 返回的教授卡片，支持收藏、详情、匹配。  
  - `ProfessorDetailDrawer`：二次查询 `professors` 表刷新详情，展示研究方向、资助方案、去向与内部备注。  
  - `ShortlistPanel`：读取 `professor_favorites`，展示个人收藏，可直接移除或跳转匹配。  
  - `ProfessorMatchDrawer`：列出可用学生，插入 `professor_match_records` 生成匹配记录。  
- 数据流：  
  - 全部读取、写入基于 Supabase，包含筛选项聚合（distinct country/university/tags）、教授列表、详情、收藏、匹配记录。  
  - 收藏按钮实时写入/删除 `professor_favorites`，RLS 保证仅本人可见。  
  - 匹配提交成功后提示用户后续在申请工作台跟进。  
- 初始数据：迁移脚本已导入 10 位示例教授，即使生产数据尚未接入也可完整演示。  
- 后续规划：  
  1. 与申请工作台任务流打通（生成待办、关联学生档案）。  
  2. 支持收藏分组、共享清单。  
  3. 引入 Supabase Edge Function，定期爬取/同步教授数据。  

