# 排班与出勤洞察（扩展版）

## 1. 模块定位

在现有团队成员排班基础上，补齐统计分析、补卡与加班审批、财务对账及报表导出能力，形成一个覆盖排班计划、实际出勤与薪酬结算闭环的运营面板。目标是让团队管理者快速洞察排班运行情况，及时处理异常，并为财务、HR 提供准确数据。

## 2. 面向角色

- **团队调度 / 教务运营**：制定排班计划、监控冲突、处理补卡与加班申请。
- **部门主管 / 项目负责人**：掌握团队负载、审批加班、优化资源投入。
- **财务 / HR**：根据加班、补贴、考勤数据进行费用结算与薪酬核算。
- **成员本人**：查看个人排班、提交补卡/加班申请、确认考勤记录。

## 3. 功能模块

1. **排班数据总览**
   - 按日/周/月展示排班数量、班次类型、导师负载热力图。
   - 看板总览关键指标：排班执行率、冲突解决率、加班时长、补卡待处理。
   - 支持按业务线、团队、地点、导师级别筛选。

2. **实际出勤 & 打卡管理**
   - 整合线上会议签到、线下课堂签到、考勤机打卡记录。
   - 自动对比计划排班与实际出勤，标记迟到/早退/缺勤/未排班。
   - 支持成员查看个人记录并发起补卡申请。

3. **补卡与加班审批**
   - 成员填写补卡/加班申请，上传佐证（截图、会议记录）。
   - 自定义审批流（如直属主管 → HR → 财务），支持 SLA 与提醒。
   - 审批通过后自动更新出勤记录与费用计算。

4. **报表中心**
   - 内置报表模板：月度出勤报表、加班费用汇总、资源利用率、冲突处理统计。
   - 支持导出 Excel / CSV / PDF，供财务和管理层使用。
   - 可配置自动发送（如每月 1 号邮件推送给财务）。

5. **对账与费用估算**
   - 根据加班时长、津贴标准自动计算费用，提供财务对账清单。
   - 支持按项目、客户、业务线拆分费用归集。
   - 提前预估高峰期投入，提供预算预警。

6. **风控与提醒**
   - 预警规则：连续 3 次迟到、加班超阈值、排班冲突未处理、未确认补卡。
   - 提供调度/主管的提醒 Inbox，支持批量处理。

## 4. 数据结构规划

| 表名 | 核心字段 | 说明 |
| --- | --- | --- |
| `attendance_records` | `id`, `employee_id`, `shift_id`, `check_in`, `check_out`, `status`, `source`, `exception_reason` | 实际出勤记录 |
| `attendance_adjustments` | `id`, `record_id`, `type`（补卡/更正）, `submitted_by`, `status`, `approver_chain`, `attachments[]` | 补卡/更正申请 |
| `overtime_requests` | `id`, `employee_id`, `date`, `hours`, `project_id`, `status`, `approver_chain`, `attachments[]`, `approved_hours` | 加班申请 |
| `overtime_rates` | `id`, `role_level`, `weekday_rate`, `weekend_rate`, `holiday_rate`, `currency` | 加班费率配置 |
| `attendance_reports` | `id`, `type`, `period_start`, `period_end`, `filters`, `generated_by`, `file_url` | 报表生成日志 |
| `attendance_alerts` | `id`, `rule_id`, `employee_id`, `triggered_at`, `status`, `resolved_at`, `notes` | 风险预警 |

现有 `staff_schedules`（计划班次）、`meetings`（实际会议）与 `tasks`（任务）数据需与考勤记录对齐，关联 `shift_id` 或 `schedule_slot_id`。

## 5. 指标体系

| 指标 | 说明 | 责任人 |
| --- | --- | --- |
| 排班执行率 | 实际出勤班次 / 计划班次 | 教务运营 |
| 加班占比 | 加班时长 / 总排班时长 | 部门主管 |
| 补卡及时率 | 已处理补卡数 / 补卡申请总数 | HR |
| 冲突响应时间 | 从冲突产生到标记解决的平均时长 | 调度负责人 |
| 费用偏差 | 加班预算 vs 实际加班费用 | 财务 |

## 6. 权限设计

- **调度管理员**：配置报表模板、修改费率、处理所有补卡/加班请求。
- **部门主管**：查看本部门数据、审批下属加班、导出限定范围报表。
- **HR & 财务**：访问全量报表、导出对账数据、统筹审批。
- **普通成员**：查看个人排班与考勤、提交补卡/加班申请。
- **审计权限**：只读访问、导出历史记录。

## 7. 集成与自动化

- **考勤硬件**：对接考勤机/门禁系统，定时拉取数据。
- **会议系统**：读取线上会议参会记录，补齐远程出勤。
- **通知渠道**：集成邮件/飞书/企业微信，发送提醒和报表。
- **薪酬系统**：导出加班确认单，供薪酬核算导入。

## 8. 迭代计划

1. **第一阶段**：整合现有排班与会议数据，新增考勤记录表、手动补卡/加班申请、报表导出。
2. **第二阶段**：自动化提醒、审批流配置、费率与项目归集、费用预估。
3. **第三阶段**：智能排班建议（结合出勤与绩效）、异常模式识别、跨系统对账自动化。

## 9. 页面与交互建议

- 将“团队成员中心”下新增 Tab「统计洞察」，展示 KPI 卡片与图表。
- 在个人详情页增加“出勤 & 加班”子区块，可下载个人月度对账单。
- 报表中心提供“快速导出”“定时发送”按钮，并显示最近生成历史。
- 审批入口可沿用现有通知组件，提供批量审批与一键提醒。


