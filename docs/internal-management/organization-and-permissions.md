# 组织与权限中心

## 1. 模块定位

组织与权限中心用于统一管理机构内部的角色、团队与访问权限。通过标准的角色模板、审批流程和日志追踪，保证不同业务线在安全、合规的前提下快速协作。

## 2. 主要使用人群

- **系统管理员**：创建组织结构、维护角色模板、配置审批流。
- **部门负责人**：申请或调整团队权限，查看本部门成员的权限状态。
- **合规 / 内审人员**：核查敏感操作、导出权限变更记录。

## 3. 核心功能

- **组织结构管理**：新增/编辑事业部、部门、项目组，支持层级拖拽与启停状态。
- **角色与权限模板**：预置“顾问、文书、客服、管理员、财务”等角色，按模块与操作粒度配置权限（查看、编辑、导出、审批）。
- **临时授权与审批**：支持权限申请、审批节点配置、到期自动收回。
- **权限审计**：对敏感操作（导出数据、删除记录、审批变更）提供日志与报表。
- **集成支持**：与 Supabase Auth / 内部 LDAP 同步，保持账号、角色一致。

## 4. 数据结构与接口

| 表/实体 | 关键字段 | 说明 |
|---------|----------|------|
| `org_units` | `id`, `name`, `parent_id`, `status` | 组织层级结构 |
| `roles` | `id`, `name`, `description`, `scope` | 角色定义，scope 用于限定模块范围 |
| `role_permissions` | `role_id`, `module`, `action` | 角色与模块操作的映射 |
| `user_roles` | `user_id`, `role_id`, `org_unit_id`, `expires_at` | 成员与角色、组织的绑定关系 |
| `permission_requests` | `id`, `user_id`, `requested_role_id`, `reason`, `status` | 权限申请工单 |

对外暴露 GraphQL / REST 接口，用于前端页面拉取角色、提交审批。需结合审计日志写入功能，确保权限变更可追溯。

## 5. 典型业务流程

1. 部门负责人在“角色模板”中选择“文书主管”，提交成员绑定申请。
2. 系统根据模板自动生成审批流（直属上级 -> 合规专员）。
3. 审批通过后，系统在 `user_roles` 表新增记录并推送通知。
4. 到期前 3 天发送提醒，可选择延续或撤销。
5. 每月自动生成权限变更报告，供合规复核。

## 6. 监控与安全

- **告警规则**：连续 3 次权限申请被拒绝、同一账号 24 小时内申请多个敏感角色、跨部门授予敏感权限需额外确认。
- **日志**：记录角色新增、权限调整、审批操作，保留至少 180 天。
- **报表**：支持导出当前权限清单、历史变更记录；与数据分析模块共享关键指标。

## 7. 迭代建议

- 支持与外部身份系统（如企业微信、Azure AD）单点登录同步。
- 引入权限冲突检测（SoD，岗位分离），自动提示不合理授权。
- 为审批流提供可视化拖拽编辑器，便于非技术人员维护流程。

