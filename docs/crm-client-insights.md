# CRM Center · 客户分群分析（Client Insights）设计文档

## 1. 模块定位
- **所属导航**：`CRM Center / Client Insights`
- **目标**：构建统一的客户画像、分群与价值分析能力，驱动精准运营与自动化触达。
- **主要用户**：市场运营、销售经理、数据分析师、服务经理、管理层。

## 2. 信息架构
```
Client Insights
├─ 顶部指标看板
│  ├ 客户总量 / 活跃客户 / 流失风险客户
│  ├ 当月新增 / 成交 / 留存率
├─ 画像与标签（Profile & Tags）
│  ├ 客户画像卡片
│  ├ 标签体系（基础/行为/价值/风险）
│  ├ 标签管理中心
├─ 分群引擎（Segmentation Builder）
│  ├ 拖拽式条件构建
│  ├ 实时人数 / 占比
│  ├ 动态化配置
├─ 价值模型（Value Models）
│  ├ RFM / CLV 可视化
│  ├ 价值象限（高价值/潜力/沉睡/流失）
│  ├ 预测模型（续约成功率、追加购买概率）
├─ 行为触发与自动化（Triggers）
│  ├ 行为事件库（开信、会议、投诉等）
│  ├ 营销与服务动作（邮件、短信、任务）
│  └ 触发规则 & 日志
└─ 报表与导出
   ├ 分群历史
   ├ 活动成效归因
   ├ 数据导出/同步
```

## 3. 功能细化

### 3.1 客户画像与标签
- **画像卡片**：包含基础信息（姓名、地区、目标专业）、关系网（推荐人、家庭成员）、当前阶段（咨询/申请/签约/服务中）。
- **标签体系**：
  - 基础标签：地域、语言、学历、申请项目。
  - 行为标签：网站访问路径、活动参与、邮件互动、会议出席、线索来源。
  - 价值标签：消费总额、毛利、续约次数、推荐人数。
  - 风险标签：投诉次数、拖欠款项、负面反馈、服务进度滞后。
- **标签管理中心**：支持创建、编辑、合并标签，批量打标签、设置自动规则（如“活动参与 X 次”自动打标签）。

### 3.2 分群引擎
- 拖拽式条件：字段 → 操作符 → 值，可嵌套 AND/OR、使用括号、时间窗口（最近 X 天）。
- 条件类型：标签、字段（单选/多选/数值/日期）、行为事件（次数/频率）、模型分值。
- 输出预览：实时计算人数、占客群比例、流失风险分布；提供样本列表预览。
- 分群保存：
  - 动态分群：实时刷新，支持订阅、自动通知。
  - 静态分群：快照，用于一次性活动或导出。
- 权限：可设为私有、团队共享、全局。

### 3.3 价值模型
- **RFM**：
  - R（Recency）：最近签约/互动/消费时间。
  - F（Frequency）：签约、续费、会议频次。
  - M（Monetary）：贡献收入、毛利。
  - 评分标准可配置，默认 1~5 分。
- **CLV**：结合历史消费、续约率、服务成本、未来贡献预测。
- **象限视图**：
  - 高价值（R、F、M 高）
  - 潜力（R 高 F 低）
  - 沉睡（R 低 F/M 中低）
  - 流失风险（R 低 + 风险标签）
- 支持钻取客户列表、导出和创建跟进任务。

### 3.4 行为触发与自动化
- 行为事件库：开信点击/未点击、活动报名、会议签到、提交表单、投诉、转介绍。
- 自动化动作：
  - 营销：邮件/短信/小程序推送。
  - 销售：创建任务、通知顾问、预约会议。
  - 服务：创建工单、发送材料、提醒文书。
- 规则示例：
  - “高潜力 + 7 天未跟进” → 推送提醒给销售经理。
  - “报名活动未签到” → 自动发送补救资料。
  - “高价值客户续签前 30 天” → 创建续约任务 + 自动发送关怀邮件。
- 日志：记录触发时间、执行动作、执行结果、异常重试。

### 3.5 报表与导出
- 分群历史：每次创建/修改分群的快照、执行动作记录。
- 活动归因：分析一个 Campaign 对不同分群的影响、后续转化。
- 数据导出：CSV、Excel、API 推送；可选择字段、加密敏感数据。
- 外部同步：支持与营销 Automation、数据仓库、BI 工具对接。

## 4. 数据模型
- `Customer`：客户主表（id、basic_info、current_stage、owner_id）。
- `CustomerTag`：客户标签关联（customer_id、tag_id、source、confidence、created_at）。
- `Tag`：标签定义（id、name、category、description、rule、owner、visibility）。
- `Segment`：分群（id、name、type、conditions_json、is_dynamic、visibility、last_calculated_at）。
- `SegmentMember`：分群成员快照（segment_id、customer_id、snapshot_time）。
- `ValueScore`：价值模型（customer_id、rfm_score、clv_score、risk_score、model_version）。
- `AutomationRule`：行为触发规则（id、name、trigger_event、conditions、actions、status、last_run_at）。
- `AutomationLog`：执行日志（rule_id、customer_id、action_type、status、details、timestamp）。

## 5. API 草案
| 功能 | Method | Endpoint | 说明 |
|------|--------|----------|------|
| 获取客户画像 | GET | `/api/crm/customers/:id/profile` | 返回基础信息、标签、价值分、最新行为 |
| 标签管理 | POST/PUT/DELETE | `/api/crm/tags` | 创建/更新/删除标签，支持批量 |
| 批量打标签 | POST | `/api/crm/tags/apply` | body 含 customer_ids、tag_id、source |
| 构建分群 | POST | `/api/crm/segments` | conditions JSON，返回分群 id |
| 运行分群 | POST | `/api/crm/segments/:id/run` | 手动执行动态分群计算 |
| 获取分群成员 | GET | `/api/crm/segments/:id/customers` | 支持分页、导出 |
| 获取价值模型 | GET | `/api/crm/customers/:id/value-score` | 价值分数、象限、建议 |
| 自动化规则管理 | POST/PATCH | `/api/crm/automation-rules` | 创建/更新触发器 |
| 自动化执行日志 | GET | `/api/crm/automation-logs` | 查询执行记录、结果 |

## 6. UI/UX 设计
- 顶部指标以卡片+趋势形式展示，支持点击跳转到对应分群或报表。
- 画像卡片：可扩展卡片组件（标签、客户旅程、最近互动），支持折叠/展开。
- 分群构建器：左侧字段面板，右侧条件区域，底部实时统计；提供即时验证与错误提示。
- 价值模型视图：热力图 + 象限散点图，鼠标悬停显示客户数量、代表客户、平均指标。
- 自动化规则面板：流程化展示（IF → THEN），可测试规则、查看最近触发。

## 7. 自动化与集成
- 与营销系统联动：分群结果自动推送至邮件/SMS/广告平台，并回写效果（打开、点击、转化）。
- 与服务模块联动：高风险客户自动生成服务预警工单。
- 与 CRM 其他模块联动：根据契约状态/服务进度变更，自动更新标签。
- 数据同步：每日将标签、价值模型结果写入数据仓库，供 BI 分析使用。

## 8. 指标与监控
- 分群覆盖率、执行频次、命中率。
- 自动化触发次数、成功率、执行时长、异常率。
- 模型表现：价值象限转移率、流失预测准确率、推荐采纳率。
- 标签活跃度：新增标签、使用频率、过期标签数量。
- 客户生命周期指标：留存率、复购率、推荐率、投诉率。

## 9. 权限控制
- 市场运营：可创建/编辑标签与分群，执行自动化。
- 销售经理：查看并使用共享分群，创建提醒/任务，不可修改核心标签。
- 数据团队：维护模型、校验数据质量，访问全部字段。
- 管理层：查看所有报表，配置战略标签、审批高风险自动化。
- 安全策略：敏感字段（如财务信息）脱敏显示；导出需双重审批，记录日志。

## 10. 迭代路线
1. **MVP**：客户画像、标签管理、基础分群、静态导出、RFM 分析。
2. **阶段二**：动态分群实时刷新、自动化触发、价值模型集成、象限视图。
3. **阶段三**：CLV 预测、行为触发库、营销自动化联动、模型自学习。
4. **阶段四**：AI 推荐运营策略、语义搜索标签、跨模块统一客户 360 视图。

---
未来可引入“客户旅程地图”“用户兴趣图谱”以及“AI 运营助手”，进一步提升个性化运营能力。
