# CRM Center · 线索列表与详情（Lead List & Detail）设计文档

## 1. 模块定位
- **所属导航**：`CRM Center / Lead List`
- **目标**：提供高效的线索筛选、批量处理与详情操作能力，支撑销售顾问与经理在漏斗中快速推进线索。
- **用户角色**：销售顾问、销售经理、市场运营、客服、管理层。

## 2. 信息架构
```
Lead List & Detail
├─ 顶部筛选栏（Filter Bar）
│  ├ 快速筛选按钮（高热度、今日必办、待分配、逾期）
│  ├ 高级筛选抽屉（状态、负责人、渠道、评分、标签、自定义字段）
│  ├ 视图选择器（表格 / 看板 / 卡片）
├─ 线索列表（List View）
│  ├ 表格列：线索名称、意向项目、阶段、负责人、评分、最近跟进、渠道
│  ├ 批量操作条（分配、创建任务、打标签、更新阶段、导出）
│  └ 行操作：查看详情、添加记录、设置提醒、标记风险
├─ 看板视图（Kanban View）
│  ├ 按阶段列出线索卡片
│  ├ 支持拖拽更新阶段
│  └ 每列显示数量、平均停留时长
├─ 线索详情页（Lead Detail）
│  ├ 概览（基本信息、评分、状态、负责人、标签）
│  ├ 沟通时间轴（与 Engagement Desk 联动）
│  ├ 任务 & SLA（待办、提醒、自动化规则）
│  ├ 申请意向（目标学校/项目、偏好、预算）
│  └ 线索来源（渠道、活动、关键词）
└─ 工具栏
   ├ 保存视图 / 共享视图
   ├ 导入/导出
   └ 自动化规则入口
```

## 3. 核心流程

### 3.1 销售顾问日常处理
1. 打开列表默认视图（“我的线索”），系统按热度排序。
2. 顶部提示当日必办线索；顾问可批量选中执行任务（发送模板邮件、创建跟进）。
3. 进入线索详情查看摘要、资料、沟通记录；点击“新增沟通”跳转至 Engagement Desk。
4. 更新阶段或指派任务，线索状态即刻同步至漏斗和 SLA。

### 3.2 经理线索分配
1. 使用过滤器筛选来源、评分、所属活动。
2. 勾选多条线索一键“分配负责人”或“创建规则”（新线索 -> 指定顾问）。
3. 查看看板视图识别停滞阶段，支持拖拽调整并自动记录操作日志。
4. 可保存自定义视图并共享给团队。

### 3.3 市场运营回溯活动效果
1. 过滤特定渠道/活动，导出线索详情（含转化阶段、负责人）。
2. 查看线索来源面板，了解投放关键词、表单来源。
3. 将高质量线索列表同步到营销自动化工具进行二次触达。

## 4. 数据模型
- `Lead`：线索主档（id、name、status、stage、owner_id、source、campaign、created_at、last_touch、contact_info、tags[]、custom_fields jsonb）。
- `LeadAssignment`：分配记录（lead_id、assigned_to、assigned_by、assigned_at）。
- `LeadStageHistory`：阶段变更（lead_id、from_stage、to_stage、changed_by、timestamp、reason）。
- `LeadReminder`：提醒（lead_id、type、trigger_time、channel、notes、status）。
- `LeadView`：保存视图（id、name、owner_id、filters_json、columns、sort、shared_with、is_default）。
- `LeadNote`：线索内部备注（lead_id、content、created_by、created_at、visibility）。

## 5. API 草案
| 功能 | Method | Endpoint | 说明 |
|------|--------|----------|------|
| 获取线索列表 | GET | `/api/crm/leads` | 支持分页、排序、复杂过滤、视图 id 参数 |
| 批量更新 | POST | `/api/crm/leads/bulk-update` | 分配、阶段、标签等批量操作 |
| 保存视图 | POST | `/api/crm/leads/views` | filters/columns/sort JSON |
| 获取视图 | GET | `/api/crm/leads/views` | 返回个人与共享视图列表 |
| 获取线索详情 | GET | `/api/crm/leads/:id` | 返回线索主档、联系人、评分、来源、标签等 |
| 更新线索 | PATCH | `/api/crm/leads/:id` | 更新状态、意向、标签、自定义字段 |
| 创建提醒 | POST | `/api/crm/leads/:id/reminders` | 创建提醒或任务 |
| 同步营销 | POST | `/api/crm/leads/:id/sync` | 推送某线索到营销/自动化平台 |
| 获取阶段历史 | GET | `/api/crm/leads/:id/stage-history` | 阶段转移日志 |
| 导出 | POST | `/api/crm/leads/export` | 过滤条件 + 导出字段 |

## 6. UI & 交互细节
- 表格支持列选择、固定、拖拽排序；行悬浮显示快捷操作按钮。
- 批量操作条在勾选后浮现，展示已选数量、可用操作，支持撤销。
- 看板列顶部显示：线索数量、平均停留时长、逾期数量；拖拽更新时弹确认并写入历史。
- 详情页顶部为 Summary 卡（评分、阶段、负责人、来自渠道、最近跟进），侧边栏展示提醒/SLA 状态。
- 自定义字段区域可折叠，展示与业务相关的附加信息（例如家庭背景、预算、竞争项目）。
- 支持多标签快速编辑（点击标签弹出选择器），热度等级以颜色/图标区分。

## 7. 自动化与规则
- 保存视图可配置“自动提醒”：例如“热度高且 24h 未跟进”时提醒负责人。
- 批量分配可依据权重或轮询分配（Round-robin）。
- 支持自定义规则：当线索进入某阶段自动创建任务或通知指定群组。
- 与 Engagement Desk 联动：新增沟通记录后，列表的“最近跟进”自动刷新。
- 与 CRM Lead Overview 联动：看板/阶段数据实时同步。

## 8. 指标与监控
- 列表视图使用量（用户、视图总数、共享视图数）。
- 批量操作执行次数、平均处理线索数。
- 阶段停留时长、阶段转换效率。
- 线索响应时长、SLA 达成率、提醒执行率。
- 线索分配均衡度（各顾问的线索量、处理量）。

## 9. 权限策略
- 顾问：查看/编辑自己负责的线索，访问共享视图，创建个人视图。
- 经理：查看团队全部线索，可共享视图、执行批量操作、导出。
- 市场：查看活动关联线索（只读），可导出做复盘。
- 管理层：全局访问权，配置自动化与 SLA。
- 安全策略：导出需记录审计日志，敏感字段可脱敏处理。

## 10. 迭代计划
1. **MVP**：表格视图、基础过滤、批量操作、线索详情概览 + 时间轴链接、保存视图。
2. **阶段二**：看板视图、自动化规则、共享视图、批量导入/导出。
3. **阶段三**：自定义字段管理、与营销自动化同步、AI 推荐下一步操作。
4. **阶段四**：优先级策略调优、预测转化率、跨模块协同（与合同/任务联动）。

---
下一步可基于本设计在 UI 中实现列表与详情页骨架，并整合到 CRM 导航。
