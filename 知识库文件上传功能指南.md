# 知识库文件上传功能指南 📤

## ✅ 已实现的功能

### 1. 文件上传 📄
- 支持 PDF、Word、PowerPoint、Excel 等文档
- 支持 MP4、MOV、AVI 等视频格式
- 最大文件大小：100MB
- 自动上传到 Supabase Storage

### 2. 封面图上传 🖼️
- 支持 JPEG、PNG、GIF、WebP 格式
- 最大图片大小：5MB
- 实时预览功能
- 不上传时自动使用默认封面图

### 3. 智能默认封面 🎨
- 文档类型：蓝色主题图片
- 视频类型：学习场景图片
- 文章类型：书籍图片
- 模板类型：办公场景图片

## 🚀 快速开始

### 步骤 1: 创建 Storage Buckets

在 Supabase Dashboard 中创建两个 Storage buckets：

#### 方法 A: 手动创建（推荐，5分钟）

1. **打开 Supabase Dashboard**
   - 访问: https://supabase.com/dashboard
   - 选择你的项目

2. **进入 Storage 页面**
   - 点击左侧菜单的 "Storage"
   - 点击 "New bucket"

3. **创建第一个 bucket: knowledge-files**
   ```
   Name: knowledge-files
   Public: ✓ (勾选)
   File size limit: 100 MB
   ```

4. **创建第二个 bucket: knowledge-thumbnails**
   ```
   Name: knowledge-thumbnails
   Public: ✓ (勾选)
   File size limit: 5 MB
   ```

5. **完成！**

#### 方法 B: 使用代码创建（开发环境）

在浏览器控制台执行（登录后端页面后）：

```javascript
// 需要在应用中调用初始化函数（仅需一次）
import { initializeStorageBuckets } from './services/storageService';
await initializeStorageBuckets();
```

### 步骤 2: 上传文件

1. **访问知识库**
   ```
   http://localhost:5173/admin/knowledge
   ```

2. **点击"上传资源"按钮**

3. **填写基本信息**
   - 输入标题
   - 选择类型（文档/视频/文章/模板）
   - 选择分类
   - 填写描述

4. **上传文件**（非文章类型）
   - 点击"点击选择文件上传"区域
   - 选择你的 PDF、Word、视频等文件
   - 看到文件名和大小确认已选择

5. **上传封面图**（可选）
   - 点击"点击上传"区域
   - 选择封面图片
   - 右侧预览区会显示图片
   - 💡 不上传也没关系，会使用默认封面

6. **添加标签**（可选）
   - 输入标签（如"美国"、"申请流程"）
   - 按回车或点击 + 添加

7. **点击"创建资源"**
   - 等待上传（会显示进度）
   - 创建成功后自动关闭

## 📋 上传流程说明

### 完整流程
```
1. 用户选择文件
   ↓
2. 前端验证（大小、类型）
   ↓
3. 点击"创建资源"
   ↓
4. 显示"正在上传文件..."
   ↓
5. 上传文件到 Supabase Storage
   ↓
6. 获取文件的公开URL
   ↓
7. 显示"正在上传封面图..."
   ↓
8. 上传封面图（或使用默认图）
   ↓
9. 显示"正在保存资源..."
   ↓
10. 保存到数据库（包含文件URL和封面URL）
    ↓
11. 创建成功！✨
```

### 上传进度提示
- "正在上传文件..." - 文件上传中
- "正在上传封面图..." - 图片上传中
- "正在保存资源..." - 保存到数据库中
- "处理中..." - 整体处理状态

## 🎯 使用示例

### 示例 1: 上传PDF文档
```
1. 标题: 美国大学申请材料清单
2. 类型: 文档
3. 分类: 申请材料
4. 描述: 完整的美国大学申请所需材料清单...
5. 上传文件: checklist.pdf (2.3MB)
6. 上传封面: cover.jpg (可选)
7. 标签: 美国, 申请材料, 清单
8. 点击"创建资源"
```

### 示例 2: 上传视频课程
```
1. 标题: 托福口语备考技巧
2. 类型: 视频
3. 分类: 语言考试
4. 描述: 详细讲解托福口语各部分的答题技巧...
5. 上传文件: toefl-speaking.mp4 (85MB)
6. 封面: 不上传（使用默认视频封面）
7. 标签: 托福, 口语, 备考
8. 点击"创建资源"
```

### 示例 3: 创建文章（无需上传文件）
```
1. 标题: 留学生文化适应指南
2. 类型: 文章
3. 分类: 留学生活
4. 描述: 帮助留学生快速适应海外生活...
5. 文章内容: （直接在文本框编写）
6. 封面: 可上传或使用默认
7. 标签: 文化适应, 留学生活
8. 点击"创建资源"
```

## 🔍 文件类型对应

### 文档类型
**支持格式**: `.pdf, .doc, .docx, .ppt, .pptx, .xls, .xlsx`
- ✅ PDF 文档
- ✅ Word 文档
- ✅ PowerPoint 演示文稿
- ✅ Excel 表格

### 视频类型
**支持格式**: `.mp4, .avi, .mov, .wmv`
- ✅ MP4 视频
- ✅ QuickTime 视频
- ✅ AVI 视频

### 模板类型
**支持格式**: `.doc, .docx, .xls, .xlsx, .ppt, .pptx, .zip`
- ✅ 文档模板
- ✅ 表格模板
- ✅ 演示模板
- ✅ 压缩包

### 文章类型
**无需文件**: 直接在系统内编写，支持 Markdown

## 💡 最佳实践

### 文件命名
✅ 好: `美国大学申请指南_2024.pdf`
❌ 差: `文件1.pdf`

### 文件大小
- 文档: 建议 < 10MB
- 视频: 建议 < 50MB（大视频可以使用外部链接）
- 图片: 建议 < 2MB

### 封面图选择
- 尺寸: 建议 800x600 或 1200x800
- 格式: PNG 或 JPEG
- 内容: 与资源主题相关的图片
- 来源: Unsplash、Pexels 等免费图库

### 标签使用
- 数量: 每个资源 3-5 个标签
- 内容: 国家、主题、类型等关键词
- 格式: 简短、准确、相关

## ⚠️ 注意事项

### 1. Storage Buckets 必须创建
如果没有创建 buckets，上传会失败并提示：
```
文件上传失败，请重试
```

**解决**: 按照"步骤1"创建 buckets

### 2. 文件大小限制
- 单个文件最大 100MB
- 封面图最大 5MB
- 超过限制会提示并拒绝上传

### 3. 文件类型限制
只能上传指定类型的文件，浏览器会自动过滤

### 4. 网络要求
上传大文件需要稳定的网络连接，建议：
- 使用有线网络
- 避免在网络高峰时段上传
- 大文件分批上传

## 🔧 故障排除

### 问题 1: 上传失败
**症状**: 点击创建后提示"文件上传失败"

**可能原因**:
- Storage buckets 未创建
- 网络连接问题  
- 文件大小超限
- 文件类型不支持

**解决**:
1. 检查 buckets 是否已创建
2. 检查文件大小和类型
3. 查看浏览器控制台错误
4. 重试上传

### 问题 2: 封面图不显示
**症状**: 上传成功但封面图显示默认图

**原因**: 封面图上传失败或URL获取失败

**解决**:
- 不影响使用，默认图也很美观
- 可以稍后手动更换封面图（编辑功能）

### 问题 3: 上传很慢
**症状**: 上传大文件时等待时间长

**正常**:
- 50MB 文件可能需要 30-60 秒
- 100MB 文件可能需要 1-2 分钟

**优化**:
- 压缩文件后再上传
- 使用更快的网络
- 或者使用外部链接替代上传

## 📊 功能对比

| 功能 | 之前 | 现在 |
|------|------|------|
| 文件上传 | ❌ 不支持 | ✅ 完整支持 |
| 封面图 | ❌ 只能填链接 | ✅ 直接上传 |
| 文件存储 | ❌ 无 | ✅ Supabase Storage |
| 默认封面 | ❌ 无 | ✅ 按类型提供 |
| 上传进度 | ❌ 无 | ✅ 实时显示 |
| 文件预览 | ❌ 无 | ✅ 封面预览 |
| 大小验证 | ❌ 无 | ✅ 自动验证 |
| 类型验证 | ❌ 无 | ✅ 自动过滤 |

## 🎉 总结

文件上传功能已完全实现！

### 核心特性
- ✅ 文件上传到 Supabase Storage
- ✅ 封面图上传并预览
- ✅ 自动使用默认封面
- ✅ 上传进度显示
- ✅ 文件大小和类型验证
- ✅ 友好的错误提示

### 快速开始
1. 在 Supabase Dashboard 创建2个 buckets
2. 刷新知识库页面
3. 点击"上传资源"
4. 选择文件和封面图
5. 提交创建
6. 完成！🎊

---

**现在你可以上传任何文档、视频等文件到知识库了！** 📚✨

需要帮助？查看控制台的详细错误信息并告诉我！

