# ğŸ¯ Supabase çœŸå®è®¤è¯ç³»ç»Ÿ - åŠŸèƒ½è¯´æ˜

## âœ¨ å·²å®ç°åŠŸèƒ½

### 1. ğŸ“§ é‚®ç®±å¯†ç ç™»å½•
- ä½¿ç”¨ Supabase Auth çš„çœŸå®è®¤è¯
- æ”¯æŒç®¡ç†å‘˜å’Œå­¦ç”Ÿä¸¤ç§è§’è‰²
- è‡ªåŠ¨å…³è”åˆ° employees/students è¡¨
- é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º

### 2. ğŸ‘¥ ç”¨æˆ·æ³¨å†Œ
- å­¦ç”Ÿå¯ä»¥è‡ªåŠ©æ³¨å†Œ
- è‡ªåŠ¨åˆ›å»º Auth ç”¨æˆ·
- è‡ªåŠ¨åˆ›å»º students è®°å½•
- å‘é€é‚®ç®±éªŒè¯
- æ³¨å†ŒæˆåŠŸå¼•å¯¼

### 3. ğŸ”‘ å¿˜è®°å¯†ç 
- å‘é€å¯†ç é‡ç½®é‚®ä»¶
- å®‰å…¨çš„é‡ç½®æµç¨‹
- ç”¨æˆ·å‹å¥½ç•Œé¢

### 4. ğŸ”’ è®¤è¯çŠ¶æ€ç®¡ç†
- å…¨å±€ AuthContext
- è‡ªåŠ¨ç›‘å¬çŠ¶æ€å˜åŒ–
- æŒä¹…åŒ–åˆ° localStorage
- æä¾› useAuth Hook

## ğŸ“ é¡¹ç›®æ–‡ä»¶

```
src/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ authService.ts          âœ… è®¤è¯æœåŠ¡ (æ–°å»º)
â”œâ”€â”€ context/
â”‚   â””â”€â”€ AuthContext.tsx         âœ… è®¤è¯ä¸Šä¸‹æ–‡ (æ–°å»º)
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ LoginPage.tsx           âœ… ç™»å½•é¡µ (å·²æ›´æ–°)
â”‚   â”œâ”€â”€ RegisterPage.tsx        âœ… æ³¨å†Œé¡µ (æ–°å»º)
â”‚   â””â”€â”€ ForgotPasswordPage.tsx  âœ… å¿˜è®°å¯†ç é¡µ (æ–°å»º)
â”œâ”€â”€ AppRoutes.tsx               âœ… è·¯ç”± (å·²æ›´æ–°)
â””â”€â”€ lib/
    â””â”€â”€ supabase.ts             âœ… Supabaseé…ç½®
```

## ğŸ® ä½¿ç”¨æ¼”ç¤º

### åœºæ™¯1: ç®¡ç†å‘˜ç™»å½•

```
è®¿é—® /login
    â†“
é€‰æ‹©"ç®¡ç†å‘˜"è§’è‰²
    â†“
è¾“å…¥é‚®ç®±: admin@example.com
è¾“å…¥å¯†ç : your-password
    â†“
ç‚¹å‡»"ç™»å½•"
    â†“
âœ… éªŒè¯æˆåŠŸ â†’ è·³è½¬åˆ° /admin/dashboard
```

### åœºæ™¯2: å­¦ç”Ÿæ³¨å†Œ

```
è®¿é—® /register
    â†“
å¡«å†™è¡¨å•:
  - å§“å: å¼ ä¸‰
  - é‚®ç®±: zhangsan@example.com  
  - å¯†ç : ******
  - ç¡®è®¤å¯†ç : ******
    â†“
ç‚¹å‡»"æ³¨å†Œ"
    â†“
âœ… æ³¨å†ŒæˆåŠŸ â†’ æç¤ºæ£€æŸ¥é‚®ç®±
    â†“
æ‰“å¼€é‚®ç®± â†’ ç‚¹å‡»éªŒè¯é“¾æ¥
    â†“
è¿”å›ç™»å½•é¡µ â†’ ä½¿ç”¨æ–°è´¦å·ç™»å½•
    â†“
âœ… ç™»å½•æˆåŠŸ â†’ è·³è½¬åˆ° /student
```

### åœºæ™¯3: å¿˜è®°å¯†ç 

```
è®¿é—® /login
    â†“
ç‚¹å‡»"å¿˜è®°å¯†ç ?"
    â†“
è¾“å…¥é‚®ç®±: user@example.com
    â†“
ç‚¹å‡»"å‘é€é‡ç½®é“¾æ¥"
    â†“
âœ… é‚®ä»¶å·²å‘é€
    â†“
æ‰“å¼€é‚®ç®± â†’ ç‚¹å‡»é‡ç½®é“¾æ¥
    â†“
è¾“å…¥æ–°å¯†ç  â†’ ç¡®è®¤
    â†“
âœ… å¯†ç å·²é‡ç½®
    â†“
è¿”å›ç™»å½• â†’ ä½¿ç”¨æ–°å¯†ç 
```

## ğŸ”„ æŠ€æœ¯å®ç°

### ç™»å½•æµç¨‹

```typescript
// 1. ç”¨æˆ·æäº¤ç™»å½•è¡¨å•
const result = await signIn(email, password, userType);

// 2. authService è°ƒç”¨ Supabase Auth
const { data, error } = await supabase.auth.signInWithPassword({
  email, 
  password
});

// 3. æŸ¥è¯¢å¹¶å…³è”ä¸šåŠ¡è¡¨
const { data: profile } = await supabase
  .from(userType === 'admin' ? 'employees' : 'students')
  .select('*')
  .eq('email', email)
  .single();

// 4. æ›´æ–° auth_id å…³è”
await supabase
  .from('employees')
  .update({ auth_id: user.id })
  .eq('id', profile.id);

// 5. è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯
return { user, profile, userType };
```

### æ³¨å†Œæµç¨‹

```typescript
// 1. åˆ›å»º Auth ç”¨æˆ·
const { data: authData } = await supabase.auth.signUp({
  email,
  password,
  options: {
    data: { name, user_type: 'student' }
  }
});

// 2. åˆ›å»º students è®°å½•
const { data: student } = await supabase
  .from('students')
  .insert({
    name,
    email,
    status: 'active',
    auth_id: authData.user.id
  })
  .select()
  .single();

// 3. å‘é€éªŒè¯é‚®ä»¶ (Supabase è‡ªåŠ¨)
// 4. è¿”å›ç»“æœ
return { user: authData.user, profile: student };
```

## ğŸ“Š æ•°æ®å…³ç³»

```
auth.users (Supabase Auth)
    â”‚
    â”‚ auth_id (UUID)
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
    â†“          â†“          â†“
employees  students   (future: mentors)
```

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **å¯†ç åŠ å¯†** - Supabase ä½¿ç”¨ bcrypt
2. **JWT Token** - è‡ªåŠ¨ç®¡ç†å’Œåˆ·æ–°
3. **é‚®ç®±éªŒè¯** - é˜²æ¶æ„æ³¨å†Œ
4. **RLS ç­–ç•¥** - è¡Œçº§å®‰å…¨
5. **Rate Limiting** - é˜²æš´åŠ›ç ´è§£

## ğŸ¨ UI ç‰¹ç‚¹

- âœ… ç°ä»£åŒ–è®¾è®¡
- âœ… å“åº”å¼å¸ƒå±€
- âœ… æš—è‰²æ¨¡å¼æ”¯æŒ
- âœ… åŠ è½½çŠ¶æ€
- âœ… é”™è¯¯æç¤º
- âœ… æˆåŠŸåé¦ˆ

## ğŸ“ å¾…é…ç½®é¡¹

### Supabase Dashboard

1. **å¯ç”¨ Email Provider**
   - Authentication â†’ Providers â†’ Email âœ…

2. **é…ç½®é‚®ä»¶æ¨¡æ¿**
   - Authentication â†’ Email Templates
   - è‡ªå®šä¹‰æ³¨å†Œ/é‡ç½®é‚®ä»¶æ ·å¼

3. **åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·**
   - Authentication â†’ Users â†’ Add user
   - æ‰‹åŠ¨åˆ›å»ºå¹¶å…³è”åˆ° employees è¡¨

4. **é…ç½® URL é‡å®šå‘**
   - Authentication â†’ URL Configuration
   - æ·»åŠ å…è®¸çš„å›è°ƒ URL

### æ•°æ®åº“

1. **æ·»åŠ  auth_id å­—æ®µ**
   ```sql
   ALTER TABLE employees ADD COLUMN auth_id UUID;
   ALTER TABLE students ADD COLUMN auth_id UUID;
   ```

2. **åˆ›å»ºç´¢å¼•**
   ```sql
   CREATE INDEX idx_employees_auth_id ON employees(auth_id);
   CREATE INDEX idx_students_auth_id ON students(auth_id);
   ```

3. **é…ç½® RLS ç­–ç•¥** (å¯é€‰ä½†æ¨è)
   ```sql
   ALTER TABLE employees ENABLE ROW LEVEL SECURITY;
   ALTER TABLE students ENABLE ROW LEVEL SECURITY;
   ```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[QUICK_START_AUTH.md](./QUICK_START_AUTH.md)** - 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
- **[SUPABASE_AUTH_SETUP.md](./SUPABASE_AUTH_SETUP.md)** - å®Œæ•´é…ç½®æŒ‡å—  
- **[SUPABASE_AUTH_å®ç°æ€»ç»“.md](./SUPABASE_AUTH_å®ç°æ€»ç»“.md)** - æŠ€æœ¯å®ç°æ€»ç»“
- **[README.md](./README.md)** - é¡¹ç›®æ€»è§ˆ

## âœ… åŠŸèƒ½æ£€æŸ¥

å¼€å‘å®Œæˆ:
- [x] âœ… ç™»å½•åŠŸèƒ½
- [x] âœ… æ³¨å†ŒåŠŸèƒ½
- [x] âœ… å¿˜è®°å¯†ç 
- [x] âœ… è®¤è¯ä¸Šä¸‹æ–‡
- [x] âœ… UI ç•Œé¢
- [x] âœ… é”™è¯¯å¤„ç†
- [x] âœ… å®Œæ•´æ–‡æ¡£

éœ€è¦é…ç½®:
- [ ] âš™ï¸ Supabase Auth Provider
- [ ] âš™ï¸ æ•°æ®åº“è¡¨ç»“æ„
- [ ] âš™ï¸ åˆ›å»ºç®¡ç†å‘˜è´¦å·
- [ ] âš™ï¸ (å¯é€‰) RLS ç­–ç•¥
- [ ] âš™ï¸ (å¯é€‰) è‡ªå®šä¹‰ SMTP

## ğŸš€ ä¸‹ä¸€æ­¥

1. **ç«‹å³å¼€å§‹:** æŸ¥çœ‹ [QUICK_START_AUTH.md](./QUICK_START_AUTH.md)
2. **è¯¦ç»†äº†è§£:** æŸ¥çœ‹ [SUPABASE_AUTH_SETUP.md](./SUPABASE_AUTH_SETUP.md)
3. **å¼€å§‹é…ç½®:** æŒ‰ç…§æ–‡æ¡£åœ¨ Supabase ä¸­é…ç½®
4. **æµ‹è¯•åŠŸèƒ½:** åˆ›å»ºç”¨æˆ·å¹¶æµ‹è¯•ç™»å½•

## ğŸ’¡ æç¤º

- å¼€å‘ç¯å¢ƒå¯ä»¥å…³é—­é‚®ç®±éªŒè¯,åŠ å¿«æµ‹è¯•
- ä½¿ç”¨ Supabase Dashboard å¯è§†åŒ–ç®¡ç†ç”¨æˆ·
- æŸ¥çœ‹ Auth Logs äº†è§£ç™»å½•æƒ…å†µ
- å®šæœŸå¤‡ä»½ Auth ç”¨æˆ·æ•°æ®

---

**å®ç°æ—¥æœŸ:** 2024-10-20  
**ç‰ˆæœ¬:** v1.0.0  
**çŠ¶æ€:** âœ… å¼€å‘å®Œæˆ,ç­‰å¾…é…ç½®
