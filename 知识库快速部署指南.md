# 知识库快速部署指南 🚀

## ⚠️ 当前状态

检测到知识库数据库表尚未创建。需要执行数据库迁移才能使用知识库功能。

## 📋 快速部署步骤（5分钟）

### 步骤 1: 打开 Supabase Dashboard

访问：https://supabase.com/dashboard

### 步骤 2: 进入 SQL Editor

1. 选择你的项目
2. 点击左侧菜单的 "SQL Editor"
3. 点击 "+ New query" 创建新查询

### 步骤 3: 复制迁移脚本

打开项目中的文件：
```
database_migrations/004_create_knowledge_base_tables.sql
```

复制所有内容（约 350 行）

### 步骤 4: 执行迁移

1. 将复制的内容粘贴到 SQL Editor
2. 点击右下角的 "Run" 按钮
3. 等待执行完成（约 5-10 秒）

### 步骤 5: 验证结果

执行完成后，你应该看到：
```
✅ 知识库数据库表创建完成！
📊 已插入 10 条示例资源数据
💬 已插入 4 条示例评论数据
```

### 步骤 6: 刷新页面

返回知识库页面，点击浏览器刷新按钮，即可看到示例数据！

## 📊 将创建的内容

迁移脚本会自动创建：

### 数据库表（4个）
- ✅ `knowledge_resources` - 知识库资源表
- ✅ `knowledge_comments` - 评论表
- ✅ `knowledge_bookmarks` - 收藏表
- ✅ `knowledge_comment_likes` - 评论点赞表

### 示例数据
- ✅ 10 条知识库资源（包含文档、视频、文章、模板）
- ✅ 4 条示例评论
- ✅ 完整的索引和触发器
- ✅ 数据完整性约束

## 🔍 验证部署

### 方法 1: 使用检查脚本
```bash
node check_knowledge_db.js
```

应该显示：
```
✅ knowledge_resources 表存在
   当前有 10 条资源数据
✅ knowledge_comments 表存在
✅ knowledge_bookmarks 表存在
✅ 知识库数据库状态正常！
```

### 方法 2: 直接访问页面
访问：http://localhost:5173/admin/knowledge

应该能看到：
- 📊 统计卡片显示数据
- 📚 10 个示例资源卡片
- 🔍 搜索和筛选功能可用
- ✅ 无错误提示

## 🎯 功能验证清单

部署成功后，测试以下功能：

- [ ] 资源列表正常显示
- [ ] 可以搜索资源
- [ ] 可以按分类/类型筛选
- [ ] 点击资源可查看详情
- [ ] 可以收藏资源
- [ ] 可以发表评论
- [ ] 可以点赞评论
- [ ] 统计数据正确显示

## ❌ 常见问题

### Q: 执行 SQL 时报错 "permission denied"
**A**: 确保你使用的是项目管理员账号。可以尝试：
1. 在 Supabase Dashboard 重新登录
2. 确认你有该项目的完整权限

### Q: 表已创建但没有数据
**A**: 检查 SQL 是否完整执行：
1. 查看 SQL Editor 的执行结果
2. 向下滚动确认看到 "已插入数据" 的提示
3. 如果没有，重新执行一次脚本

### Q: 页面仍然显示错误
**A**: 
1. 清除浏览器缓存
2. 强制刷新页面 (Ctrl+Shift+R 或 Cmd+Shift+R)
3. 运行 `node check_knowledge_db.js` 确认表已创建
4. 检查浏览器控制台是否有其他错误

### Q: 想要清空重新开始
**A**: 在 SQL Editor 执行：
```sql
DROP TABLE IF EXISTS knowledge_comment_likes CASCADE;
DROP TABLE IF EXISTS knowledge_bookmarks CASCADE;
DROP TABLE IF EXISTS knowledge_comments CASCADE;
DROP TABLE IF EXISTS knowledge_resources CASCADE;
```
然后重新执行迁移脚本。

## 📞 需要帮助？

如果遇到问题：
1. 查看浏览器控制台的错误信息
2. 运行 `node check_knowledge_db.js` 查看数据库状态
3. 检查 Supabase 项目是否正常运行
4. 确认环境变量配置正确（VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY）

## ✅ 部署完成

恭喜！知识库功能已经可以使用了！🎉

现在你可以：
- 浏览 10 个示例资源
- 测试搜索和筛选功能
- 收藏喜欢的资源
- 发表评论和互动
- 开始上传自己的资源

享受知识库带来的便利吧！📚

